
fpath = "I:/Health Plan Comparison/HIX_Plan_Comparison_NM/Data/2023/Standard Plan Rules"
file = 'rule_import_table.xlsx'
deliverable_path = 'I:/Health Plan Comparison/HIX_Plan_Comparison_NM/Report/PY2024/'

rule.template = "I:\Health Plan Comparison\HIX_Plan_Comparison_NM\Data\2023\Standard Plan Rules\PY2024 Standard Plan Rules.xlsx"
user = 'tbanks'

sql.alchemy = "mssql+pymssql:///?odbc_connect={}"
sql.username = "tbanks"
sql.password = ""
sql.server = "CSSNPI"
sql.trusted_connection = True

import.database = 'hie_nm_2023'
import.schema = 'rel'
import.table = 'plan_benefit_rule'

extract.database = "serff_model_extraction"
extract.billable = "SELECT distinct d.network_tier, b.benefit_id, d.plan_name, pv.plan_variant_name, b.orig_coin_value ,b.orig_copay_value, d.hios_plan_id, d.metal, d.plan_id FROM serff_model_extraction.relational.plan_variant_billable b inner JOIN( SELECT b.network_tier, b.hios_plan_id, p.standard_component, SUBSTRING(b.hios_plan_id, LEN(b.hios_plan_id) - 1, 2) AS plan_id, p.metal, p.plan_name FROM serff_model_extraction.relational.plan_variant_billable b LEFT JOIN serff_model_extraction.relational.[plan] p ON LEFT(b.hios_plan_id, 14) = p.standard_component WHERE hios_plan_id LIKE '%NM%' and network_tier LIKE '%Tier 1%' AND p.standard_component LIKE '%NM%' and p.plan_name like '%Clear Cost%' AND SUBSTRING(b.hios_plan_id, LEN(b.hios_plan_id) - 1, 2) IN (01, 04, 90, 95, 99)) d ON d.hios_plan_id = b.hios_plan_id left JOIN ( SELECT cost_sharing_variant, plan_variant_name from serff_model_extraction.relational.[plan_variant] where cost_sharing_variant LIKE '%NM%' ) pv on pv.cost_sharing_variant = b.hios_plan_id WHERE b.hios_plan_id LIKE '%NM%' and b.benefit_id in (select distinct benefit_id from hie_nm_2023.rel.plan_benefit_rule) and b.run_id = 48522 and b.network_tier like '%Tier 1%' and pv.plan_variant_name like '%Clear Cost%'"
extract.deductible = "select distinct b.benefit_id, b.value as formatted_value, pv.cost_sharing_variant, pv.plan_variant_name, d.metal, d.plan_id from serff_model_extraction.relational.plan_variant_deductible b inner JOIN( SELECT b.benefit_id, b.network_tier, b.value, b.cost_sharing_variant, p.standard_component, SUBSTRING(b.cost_sharing_variant, LEN(b.cost_sharing_variant) - 1, 2) AS plan_id, p.metal, p.plan_name FROM serff_model_extraction.relational.plan_variant_deductible b LEFT JOIN serff_model_extraction.relational.[plan] p ON LEFT(b.cost_sharing_variant, 14) = p.standard_component WHERE cost_sharing_variant LIKE '%NM%' and b.benefit_id in (57, 18) and network_tier LIKE '%Tier 1%' AND p.standard_component LIKE '%NM%' and p.plan_name like '%Clear Cost%' AND SUBSTRING(b.cost_sharing_variant, LEN(b.cost_sharing_variant) - 1, 2) IN (01, 04, 99, 95, 90)) d ON d.cost_sharing_variant = b.cost_sharing_variant left JOIN ( SELECT cost_sharing_variant, plan_variant_name from serff_model_extraction.relational.[plan_variant] where cost_sharing_variant LIKE '%NM%' ) pv on pv.cost_sharing_variant = b.cost_sharing_variant WHERE b.cost_sharing_variant LIKE '%NM%' and b.benefit_id in (57, 18) and b.run_id = 48522 and b.network_tier like '%Tier 1%' and pv.plan_variant_name like '%Clear Cost%'"
extract.moop = "select distinct b.benefit_id, b.value as formatted_value, pv.cost_sharing_variant, pv.plan_variant_name, d.metal, d.plan_id from serff_model_extraction.relational.plan_variant_moop b inner JOIN( SELECT b.benefit_id, b.network_tier, b.cost_sharing_variant, p.standard_component, SUBSTRING(b.cost_sharing_variant, LEN(b.cost_sharing_variant) - 1, 2) AS plan_id, p.metal, p.plan_name FROM serff_model_extraction.relational.plan_variant_moop b LEFT JOIN serff_model_extraction.relational.[plan] p ON LEFT(b.cost_sharing_variant, 14) = p.standard_component WHERE cost_sharing_variant LIKE '%NM%' and b.benefit_id in (select distinct benefit_id from hie_nm_2023.rel.plan_benefit_rule) and network_tier LIKE '%Tier 1%' AND p.standard_component LIKE '%NM%' and p.plan_name like '%Clear Cost%' AND SUBSTRING(b.cost_sharing_variant, LEN(b.cost_sharing_variant) - 1, 2) IN (01, 04, 99, 95, 90)) d ON d.cost_sharing_variant = b.cost_sharing_variant left JOIN ( SELECT cost_sharing_variant, plan_variant_name from serff_model_extraction.relational.[plan_variant] where cost_sharing_variant LIKE '%NM%' ) pv on pv.cost_sharing_variant = b.cost_sharing_variant WHERE b.cost_sharing_variant LIKE '%NM%' and b.benefit_id in (select distinct benefit_id from hie_nm_2023.rel.plan_benefit_rule) and b.run_id = 48522 and b.network_tier like '%Tier 1%' and pv.plan_variant_name like '%Clear Cost%'"